Query Builder Reference
=======================

.. note::

    This is document is generated by the PHPCR-ODM

Reference
---------

.. _qbref_node_constraintandx:

ConstraintAndx
~~~~~~~~~~~~~~



**Type**: :ref:`constraint <qbref_type_constraint>`

**Extends**: :ref:`ConstraintFactory <qbref_node_constraintfactory>`

**Children**:
    * **2..2** :ref:`constraint <qbref_type_constraint>`


.. _qbref_node_constraintcomparison:

ConstraintComparison
~~~~~~~~~~~~~~~~~~~~



**Type**: :ref:`constraint <qbref_type_constraint>`

**Extends**: :ref:`OperandFactory <qbref_node_operandfactory>`

**Children**:
    * **1..1** :ref:`operand_dynamic <qbref_type_operand_dynamic>`
    * **1..1** :ref:`operand_static <qbref_type_operand_static>`


.. _qbref_node_constraintfactory:

ConstraintFactory
~~~~~~~~~~~~~~~~~



**Type**: :ref:`constraint_factory <qbref_type_constraint_factory>`

**Children**:
    * **1..1** :ref:`constraint <qbref_type_constraint>`


->andX
^^^^^^

And composite constraint, usage

->orX
^^^^^

Or composite constraint:

.. code-block:: php
    
    <?php
    $qb->where()
    ->orX()
    ->fieldExsts('prop_1', 'sel_1')
    ->fieldExsts('prop_2', 'sel_1')
    ->end()


->not
^^^^^

Inverts the truth of any given appended costraint.

.. code-block:: php
    
    <?php
    $qb->where()->not()->fieldExists('sel_1.foobar')


->eq
^^^^

Equality comparison constraint.

.. code-block:: php
    
    <?php
    $qb->where()
    ->eq()
    ->field('sel_1.foobar')->end()
    ->literal('var_1')->end()
    ->end()


->neq
^^^^^

Inequality comparison constraint

.. code-block:: php
    
    <?php
    $qb->where()
    ->neq()
    ->field('sel_1.foobar')->end()
    ->literal('var_1')->end()
    ->end()


->lt
^^^^

Less than comparison constraint

.. code-block:: php
    
    <?php
    $qb->where()
    ->lt()
    ->field('sel_1.foobar')->end()
    ->literal(5)->end()
    ->end()


->lte
^^^^^

Less than or equal to comparison constraint

.. code-block:: php
    
    <?php
    $qb->where()
    ->lte()
    ->field('sel_1.foobar')->end()
    ->literal(5)->end()
    ->end()


->gt
^^^^

Greater than comparison constraint

.. code-block:: php
    
    <?php
    $qb->where()
    ->gt()
    ->field('sel_1.foobar')->end()
    ->literal(5)->end()
    ->end()


->gte
^^^^^

Greater than or equal to comparison constraint

.. code-block:: php
    
    <?php
    $qb->where()
    ->gte()
    ->field('sel_1.foobar')->end()
    ->literal(5)->end()
    ->end()


->like
^^^^^^

Like comparison constraint.
Use "%" as wildcards.

.. code-block:: php
    
    <?php
    $qb->where()
    ->lt()
    ->field('sel_1.foobar')->end()
    ->literal('foo%')->end()
    ->end();


The above example will match "foo" and "foobar" but not "barfoo".

.. _qbref_node_constraintnot:

ConstraintNot
~~~~~~~~~~~~~



**Type**: :ref:`constraint <qbref_type_constraint>`

**Extends**: :ref:`ConstraintFactory <qbref_node_constraintfactory>`

**Children**:
    * **1..1** :ref:`constraint <qbref_type_constraint>`


.. _qbref_node_constraintorx:

ConstraintOrx
~~~~~~~~~~~~~



**Type**: :ref:`constraint <qbref_type_constraint>`

**Extends**: :ref:`ConstraintFactory <qbref_node_constraintfactory>`

**Children**:
    * **2..2** :ref:`constraint <qbref_type_constraint>`


.. _qbref_node_from:

From
~~~~



**Type**: :ref:`from <qbref_type_from>`

**Children**:
    * **1..1** :ref:`source <qbref_type_source>`


.. _qbref_node_operanddynamicfactory:

OperandDynamicFactory
~~~~~~~~~~~~~~~~~~~~~

Factory/node class for dynamic operands.

As the name suggests, dynamic operand values change
according to the node being compared and are used as
"left hand side" (lop) operands in comparisons and
in orderings.

**Type**: :ref:`operand_dynamic_factory <qbref_type_operand_dynamic_factory>`

**Children**:
    * **1..1** :ref:`operand_dynamic <qbref_type_operand_dynamic>`


->fullTextSearchScore
^^^^^^^^^^^^^^^^^^^^^

Represents document rank by relevance to the full text search expression
given by the "fullTextSearch" constraint.

http://www.day.com/specs/jcr/2.0/6_Query.html#FullTextSearchScore

.. code-block:: php
    
    <?php
    $qb->where()
    ->gt()
    ->fullTextSearchScore('sel_1')->end()
    ->literal(50)->end()
    ->end()
    
    $qb->orderBy()
    ->ascending()->fullTextSearchScore('sel_1')->end()


**Arguments**:

* **$selectorName**: *string* - Name of selector to use

->length
^^^^^^^^

Length operand resolves to length of child operand.

.. code-block:: php
    
    <?php
    $qb->where()
    ->gt()
    ->length('sel_1.prop_1')->end()
    ->literal(50)->end()
    ->end()
    
    $qb->orderBy()
    ->ascending()->fullTextSearchScore('sel_1')->end()


**Arguments**:

* **$field**: *string* - name of field to check, including selector name.

->lowerCase
^^^^^^^^^^^

LowerCase operand evaluates to lower-cased string of child operand:

.. code-block:: php
    
    <?php
    $qb->where()
    ->eq()
    ->lowerCase()->field('sel_1.prop_1')->end()
    ->literal('lower_case')->end()
    ->end()


->upperCase
^^^^^^^^^^^

UpperCase operand evaluates to upper-cased string of child operand:

.. code-block:: php
    
    <?php
    $qb->where()
    ->eq()
    ->upperCase()->field('sel_1.prop_1')->end()
    ->literal('UPPER_CASE')->end()
    ->end()


->localName
^^^^^^^^^^^

Document local name resolves to the local (non namespaced)
name of the node being compared.

For example, if a node has the path "/path/to/foobar", then "foobar"
is the local node name.

.. code-block:: php
    
    <?php
    $qb->where()
    ->eq()
    ->localName('sel_1')
    ->literal('my_node_name')
    ->end()


Relates to PHPCR NodeLocalNameInterface

**Arguments**:

* **$selectorName**: *string* - Name of selector to use

->name
^^^^^^

Resolves to the namespaced name of the node being compared.

For example, if a node has the path "/path/to/bar:foobar", then
"bar:foobar" is the namespaced node name.

.. code-block:: php
    
    <?php
    $qb->where()
    ->eq()
    ->name('sel_1')
    ->literal('namespace:my_node_name')
    ->end()


Relates to PHPCR NodeNameInterface.

**Arguments**:

* **$selectorName**: *string* - Name of selector to use

->field
^^^^^^^

Resolves to the value of the specified field.

.. code-block:: php
    
    <?php
    $qb->where()
    ->eq()
    ->field('sel_1.prop_name')
    ->literal('my_field_value')
    ->end()


**Arguments**:

* **$field**: *string* - name of field to check, including selector name.

.. _qbref_node_operanddynamiclowercase:

OperandDynamicLowerCase
~~~~~~~~~~~~~~~~~~~~~~~



**Type**: :ref:`operand_dynamic <qbref_type_operand_dynamic>`

**Extends**: :ref:`OperandDynamicFactory <qbref_node_operanddynamicfactory>`

**Children**:
    * **1..1** :ref:`operand_dynamic <qbref_type_operand_dynamic>`


.. _qbref_node_operanddynamicuppercase:

OperandDynamicUpperCase
~~~~~~~~~~~~~~~~~~~~~~~



**Type**: :ref:`operand_dynamic <qbref_type_operand_dynamic>`

**Extends**: :ref:`OperandDynamicFactory <qbref_node_operanddynamicfactory>`

**Children**:
    * **1..1** :ref:`operand_dynamic <qbref_type_operand_dynamic>`


.. _qbref_node_operandfactory:

OperandFactory
~~~~~~~~~~~~~~

Factory/node class for dynamic all operands.

Extends OperandDynamicFactory, and adds the static operands.

Traits would be really useful here.

**Type**: :ref:`operand_dynamic_factory <qbref_type_operand_dynamic_factory>`

**Extends**: :ref:`OperandDynamicFactory <qbref_node_operanddynamicfactory>`

**Children**:
    * **1..1** :ref:`operand_dynamic <qbref_type_operand_dynamic>`


->parameter
^^^^^^^^^^^

Resolves to the value of the variable bound to the given $name.

Relates to PHPCR BindVariableValueInterface

.. code-block:: php
    
    <?php
    $qb->where()->eq()->field('f.foobar')->parameter('param_1');


**Arguments**:

* **$name**: *string* - Name of parameter to resolve.

->literal
^^^^^^^^^

Resolves to the given literal value.

.. code-block:: php
    
    <?php
    $qb->where()->eq()->field('f.foobar')->litreal('Literal Value');


**Arguments**:

* **$value**: *string* - Literal value.

.. _qbref_node_operandstaticfactory:

OperandStaticFactory
~~~~~~~~~~~~~~~~~~~~

Factory/node class for static operands.

As the name suggests, static operand values do
not change once initialized and are used as the "right hand
side" operands in comparisons.

Inherits from dynamic factory, see note there.

**Type**: :ref:`operand_static_factory <qbref_type_operand_static_factory>`

**Extends**: :ref:`OperandFactory <qbref_node_operandfactory>`

**Children**:
    * **1..1** :ref:`operand_static <qbref_type_operand_static>`


.. _qbref_node_orderby:

OrderBy
~~~~~~~

Factory/node class for order by.

Query results can be ordered by any dynamic operand
in either ascending or descending order.

**Type**: :ref:`order_by <qbref_type_order_by>`

**Children**:
    * **0..*** :ref:`ordering <qbref_type_ordering>`


->ascending
^^^^^^^^^^^

Add ascending ordering:

.. code-block:: php
    
    <?php
    $qb->orderBy()->ascending()->field('sel_1.prop_1');


->descending
^^^^^^^^^^^^

Add descending ordering:

.. code-block:: php
    
    <?php
    $qb->orderBy()->descending()->field('sel_1.prop_1');


.. _qbref_node_orderbyadd:

OrderByAdd
~~~~~~~~~~



**Type**: :ref:`order_by <qbref_type_order_by>`

**Extends**: :ref:`OrderBy <qbref_node_orderby>`

**Children**:
    * **0..*** :ref:`ordering <qbref_type_ordering>`


.. _qbref_node_ordering:

Ordering
~~~~~~~~



**Type**: :ref:`ordering <qbref_type_ordering>`

**Extends**: :ref:`OperandDynamicFactory <qbref_node_operanddynamicfactory>`

**Children**:
    * **1..1** :ref:`operand_dynamic <qbref_type_operand_dynamic>`


.. _qbref_node_querybuilder:

QueryBuilder
~~~~~~~~~~~~

Base QueryBuilder node.

**Type**: :ref:`builder <qbref_type_builder>`

**Children**:
    * **0..*** :ref:`select <qbref_type_select>`
    * **1..1** :ref:`from <qbref_type_from>`
    * **0..1** :ref:`where <qbref_type_where>`
    * **0..*** :ref:`order_by <qbref_type_order_by>`


->where
^^^^^^^

Where factory node is used to specify selection criteria:

.. code-block:: php
    
    <?php
    $qb->where()
    ->eq()->field('a.foobar')->literal('bar')->end()


->andWhere
^^^^^^^^^^

Add additional selection criteria using the AND operator.

->orWhere
^^^^^^^^^

Add additional selection criteria using the OR operator.
see "where"

->from
^^^^^^

Set the from source for the query.

.. code-block:: php
    
    <?php
    $qb->from()->document('Foobar', 'a')
    
    // or with a join ...
    
    -$qb->from()->joinInner()
    ->left()->document('Foobar', 'a')->end()
    ->right()->document('Foobar', 'a')->end()
    ->end()


->fromDocument
^^^^^^^^^^^^^^

Shortcut for:

.. code-block:: php
    
    <?php
    $qb->from()->document('Foobar', 'a')->end()


Which becomes:

.. code-block:: php
    
    <?php
    $qb->fromDocument('Foobar', 'a');


Replaces any existing from source.

**Arguments**:

* **$documentFqn**: *string* - Fully qualified class name for document.
* **$selectorName**: *string* - Selector name.

->addJoinLeftOuter
^^^^^^^^^^^^^^^^^^

Replace the existing source with a left outer join source using the existing
source as the left operand.

.. code-block:: php
    
    <?php
    $qb->fromDocument('Foobar', 'a')
    ->addJoinLeftOuter()
    ->right()->document('Barfoo', 'b')->end()
    ->condition()->equi('a.prop_1', 'b.prop_2')
    ->end();


->addJoinRightOuter
^^^^^^^^^^^^^^^^^^^

Replace the existing source with a right outer join source using the existing
source as the left operand.

.. code-block:: php
    
    <?php
    $qb->fromDocument('Foobar', 'a')
    ->addJoinRightOuter()
    ->right()->document('Barfoo', 'b')->end()
    ->condition()->equi('a.prop_1', 'b.prop_2')
    ->end()


->addJoinInner
^^^^^^^^^^^^^^

Replace the existing source with an inner join source using the existing
source as the left operand.

.. code-block:: php
    
    <?php
    $qb->fromDocument('Foobar', 'a')
    ->addJoinInner()
    ->right()->document('Barfoo', 'b')->end()
    ->condition()->equi('a.prop_1', 'b.prop_2')
    ->end()


->select
^^^^^^^^

Method to add properties for selection to builder tree, replaces any
existing select.

Number of property nodes is unbounded.

.. code-block:: php
    
    <?php
    $qb->select()
    ->field('a.prop_1')
    ->field('a.prop_2')
    ->field('a.prop_3')
    ->end()


->addSelect
^^^^^^^^^^^

Add additional properties to selection.

.. code-block:: php
    
    <?php
    $qb->select()
    ->field('a.prop_1')
    ->end()
    ->addSelect()
    ->field('a.prop_2')
    ->field('a.prop_3')
    ->field('a.prop_4')
    ->end()


->orderBy
^^^^^^^^^

Add orderings to the builder tree.

Number of orderings is unbounded.

.. code-block:: php
    
    <?php
    $qb->orderBy()
    ->ascending()->field('a.prop_1')
    ->descending()->field('a.prop_2')
    ->end()


->addOrderBy
^^^^^^^^^^^^

Add additional orderings to the builder tree.

See "orderBy"

.. _qbref_node_select:

Select
~~~~~~



**Type**: :ref:`select <qbref_type_select>`

**Children**:
    * **0..*** :ref:`property <qbref_type_property>`


->field
^^^^^^^

Field to select.

.. code-block:: php
    
    <?php
    $qb->select()
    ->field('sel_1.foobar')
    ->field('sel_1.barfoo');


**Arguments**:

* **$field**: *string* - name of field to check, including selector name

.. _qbref_node_selectadd:

SelectAdd
~~~~~~~~~



**Type**: :ref:`select <qbref_type_select>`

**Extends**: :ref:`Select <qbref_node_select>`

**Children**:
    * **0..*** :ref:`property <qbref_type_property>`


.. _qbref_node_sourcejoin:

SourceJoin
~~~~~~~~~~

$from->joinInner()->left()->document()->

**Type**: :ref:`source <qbref_type_source>`

**Children**:
    * **1..1** :ref:`source_join_condition_factory <qbref_type_source_join_condition_factory>`
    * **1..1** :ref:`source_join_left <qbref_type_source_join_left>`
    * **1..1** :ref:`source_join_right <qbref_type_source_join_right>`


->left
^^^^^^

Specify the document source for the "left" side of a join.

->right
^^^^^^^

Specify the document source for the "right" side of a join.

->condition
^^^^^^^^^^^

Specify the join condition.

.. _qbref_node_sourcejoinconditionfactory:

SourceJoinConditionFactory
~~~~~~~~~~~~~~~~~~~~~~~~~~

Factory/node class for join conditions.

**Type**: :ref:`source_join_condition_factory <qbref_type_source_join_condition_factory>`

**Children**:
    * **1..1** :ref:`source_join_condition <qbref_type_source_join_condition>`


->descendant
^^^^^^^^^^^^

Descendant join condition.

.. code-block:: php
    
    <?php
    $qb->from()
    ->joinInner()
    ->left()->document('Foo/Bar/One', 'sel_1')->end()
    ->right()->document('Foo/Bar/Two', 'sel_2')->end()
    ->condition()
    ->descendant('sel_1', 'sel_2')
    ->end()
    ->end()


**Arguments**:

* **$descendantSelectorName**: *string* - Name of selector for descendant documents.
* **$ancestorSelectorName**: *string* - Name of selector to match for ancestor documents.

->equi
^^^^^^

Equi (equality) join condition.

.. code-block:: php
    
    <?php
    $qb->from()
    ->joinInner()
    ->left()->document('Foo/Bar/One', 'sel_1')->end()
    ->right()->document('Foo/Bar/Two', 'sel_2')->end()
    ->condition()
    ->equi('sel_1.prop_1', 'sel_2.prop_2')
    ->end()
    ->end()


**Arguments**:

* **$field1**: *string* - Field name for first field.
* **$field2**: *string* - Field name for second field.

->child
^^^^^^^

Child document join condition.

.. code-block:: php
    
    <?php
    $qb->from()
    ->joinInner()
    ->left()->document('Foo/Bar/One', 'sel_1')->end()
    ->right()->document('Foo/Bar/Two', 'sel_2')->end()
    ->condition()
    ->child('sel_1', 'sel_2')
    ->end()
    ->end()


**Arguments**:

* **$childSelectorName**: *string* - Name of selector for child documents.
* **$parentSelectorName**: *string* - Name of selector to match for parent documents.

->same
^^^^^^

Same document join condition:

.. code-block:: php
    
    <?php
    $qb->from()
    ->joinInner()
    ->left()->document('Foo/Bar/One', 'sel_1')->end()
    ->right()->document('Foo/Bar/Two', 'sel_2')->end()
    ->condition()
    ->same('sel_1', 'sel_2', '/path_to/sel_2/document')
    ->end()
    ->end()


**Arguments**:

* **$selector1Name**: *string* - Name of first selector.
* **$selector2Name**: *string* - Name of first selector.
* **$selector2Path**: *string* - Path for documents of second selector.

.. _qbref_node_sourcejoinleft:

SourceJoinLeft
~~~~~~~~~~~~~~



**Type**: :ref:`source_join_left <qbref_type_source_join_left>`

**Extends**: :ref:`From <qbref_node_from>`

**Children**:
    * **1..1** :ref:`source <qbref_type_source>`


.. _qbref_node_sourcejoinright:

SourceJoinRight
~~~~~~~~~~~~~~~



**Type**: :ref:`source_join_right <qbref_type_source_join_right>`

**Extends**: :ref:`From <qbref_node_from>`

**Children**:
    * **1..1** :ref:`source <qbref_type_source>`


.. _qbref_node_where:

Where
~~~~~



**Type**: :ref:`where <qbref_type_where>`

**Extends**: :ref:`ConstraintFactory <qbref_node_constraintfactory>`

**Children**:
    * **1..1** :ref:`constraint <qbref_type_constraint>`


.. _qbref_node_whereand:

WhereAnd
~~~~~~~~

Append an additional "where" with an AND

**Type**: :ref:`where <qbref_type_where>`

**Extends**: :ref:`Where <qbref_node_where>`

**Children**:
    * **1..1** :ref:`constraint <qbref_type_constraint>`


.. _qbref_node_whereor:

WhereOr
~~~~~~~

Append an additional "where" with an OR

**Type**: :ref:`where <qbref_type_where>`

**Extends**: :ref:`Where <qbref_node_where>`

**Children**:
    * **1..1** :ref:`constraint <qbref_type_constraint>`

* **Type**: :ref:`constraint <qbref_type_constraint>`
* **Extends**: :ref:`ConstraintFactory <qbref_node_constraintfactory>`
* **Children**:
    * **2..2** :ref:`constraint <qbref_type_constraint>`
